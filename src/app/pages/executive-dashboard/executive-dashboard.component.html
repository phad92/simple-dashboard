<!-- Executive Dashboard Hero Banner -->
<div class="bg-gradient-to-r from-slate-900 via-indigo-900 to-violet-900 text-white">
    <div class="max-w-7xl mx-auto px-4 md:px-6 py-5">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold mb-1">Executive Dashboard</h1>
                <p class="text-white/60 text-sm">{{ currentDate }} • Last updated {{ lastUpdated }}</p>
            </div>
            <div class="flex items-center gap-3">
                <button pButton icon="pi pi-download" label="Export" class="p-button-outlined p-button-sm"
                    style="color: white; border-color: rgba(255,255,255,0.3);"></button>
                <button pButton icon="pi pi-refresh" label="Refresh" class="p-button-sm"
                    style="background: rgba(255,255,255,0.1); border: none;"></button>
            </div>
        </div>
    </div>
</div>

<main class="max-w-7xl mx-auto px-4 md:px-6 py-4">
    <p-tabView styleClass="exec-tabs" (activeIndexChange)="onTabChange($event)">
        <!-- ============================================ -->
        <!-- PROVIDERS TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-building mr-2"></i>
                <span>Providers</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="facilityTypeOptions" [(ngModel)]="selectedFacilityType"
                            placeholder="Facility Type" [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="exec-stat-card">
                    <div class="exec-stat-icon indigo">
                        <i class="pi pi-building"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatNumber(providerMetrics.totalActiveProviders) }}</span>
                        <span class="exec-stat-label">Total Active Providers</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon emerald">
                        <i class="pi pi-user-plus"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ providerMetrics.totalNewProviders }}</span>
                        <span class="exec-stat-label">New Providers (1 year)</span>
                        <span class="exec-stat-change positive">{{ providerMetrics.newProvidersPercentage }}% of
                            total</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon"
                        [class]="providerMetrics.distributionVariance === 'high' ? 'amber' : 'emerald'">
                        <i class="pi pi-chart-line"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value capitalize">{{ providerMetrics.distributionVariance }}</span>
                        <span class="exec-stat-label">Distribution Variance</span>
                        <span class="exec-stat-change"
                            [class]="providerMetrics.distributionVariance === 'high' ? 'warning' : 'positive'">
                            CV: {{ providerMetrics.varianceCoefficient | number:'1.2-2' }}
                        </span>
                    </div>
                </div>

                <div class="exec-stat-card flex-col items-center">
                    <span class="text-sm font-medium text-slate-600 mb-2">By Facility Type</span>
                    <div class="w-[120px] h-[120px]">
                        <p-chart type="doughnut" [data]="facilityTypeChartData"
                            [options]="facilityTypeChartOptions"></p-chart>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title"><i class="pi pi-map text-indigo-500"></i> Regional Provider Distribution</h3>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    @for (region of providerMetrics.regionalData; track region.region) {
                    <div class="heatmap-cell" [class]="getIntensityClass(region.intensity)">
                        <span class="font-semibold text-sm">{{ region.region }}</span>
                        <span class="text-lg font-bold">{{ region.providers | number }}</span>
                        <span class="text-xs">+{{ region.newProviders }} new</span>
                    </div>
                    }
                </div>
                <div class="flex items-center gap-4 mt-4 pt-4 border-t border-slate-100">
                    <span class="text-xs text-slate-500">Legend:</span>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-emerald-200"></span><span
                            class="text-xs">Low</span></div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-amber-200"></span><span
                            class="text-xs">Medium</span></div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-orange-200"></span><span
                            class="text-xs">High</span></div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-red-200"></span><span
                            class="text-xs">Critical</span></div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- PROVIDER MAP TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-map mr-2"></i>
                <span>Provider Map</span>
            </ng-template>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                <!-- Map Container -->
                <div class="lg:col-span-3 dashboard-card p-0 overflow-hidden">
                    <div id="provider-map" class="w-full h-[500px] rounded-lg"></div>
                </div>

                <!-- Map Legend & Stats -->
                <div class="flex flex-col gap-4">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="pi pi-info-circle text-indigo-500 mr-2"></i>Map Legend</h3>
                        </div>
                        <div class="flex flex-col gap-3">
                            <div class="flex items-center gap-2">
                                <span class="w-4 h-4 rounded-full bg-emerald-500"></span>
                                <span class="text-sm">Low density</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-4 h-4 rounded-full bg-amber-500"></span>
                                <span class="text-sm">Medium density</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-4 h-4 rounded-full bg-orange-500"></span>
                                <span class="text-sm">High density</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="w-4 h-4 rounded-full bg-red-500"></span>
                                <span class="text-sm">Critical density</span>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500 mt-3 pt-3 border-t border-slate-100">
                            Circle size represents provider count. Click a marker for details.
                        </p>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Stats</h3>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Total Providers</span>
                                <span class="font-bold text-indigo-600">{{
                                    formatNumber(providerMetrics.totalActiveProviders) }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">New This Year</span>
                                <span class="font-bold text-emerald-600">{{ providerMetrics.totalNewProviders }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Regions Covered</span>
                                <span class="font-bold">{{ providerMetrics.regionalData.length }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Top Regions</h3>
                        </div>
                        <div class="space-y-2">
                            @for (region of providerMetrics.regionalData.slice(0, 5); track region.region) {
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-600">{{ region.region }}</span>
                                <span class="font-semibold">{{ region.providers | number }}</span>
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- SUBMISSIONS & VETTING TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-file-edit mr-2"></i>
                <span>Submissions</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="exec-stat-card">
                    <div class="exec-stat-icon cyan">
                        <i class="pi pi-file"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatNumber(submissionMetrics.todaySubmissions.volume)
                            }}</span>
                        <span class="exec-stat-label">Today's Submissions</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon teal">
                        <i class="pi pi-dollar"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatCurrency(submissionMetrics.todaySubmissions.cost)
                            }}</span>
                        <span class="exec-stat-label">Today's Cost</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon indigo">
                        <i class="pi pi-globe"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ submissionMetrics.todaySubmissions.onlinePercentage }}%</span>
                        <span class="exec-stat-label">Online Submissions</span>
                        <span class="exec-stat-change neutral">{{ submissionMetrics.todaySubmissions.offlinePercentage
                            }}% offline</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon emerald">
                        <i class="pi pi-check-circle"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ submissionMetrics.claimsProcessedPercentage }}%</span>
                        <span class="exec-stat-label">Claims Processed</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">{{ submissionMetrics.yearLabel }} Year-to-Date</h3>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="mini-stat">
                            <span class="mini-stat-value">{{ formatNumber(submissionMetrics.ytdVolume) }}</span>
                            <span class="mini-stat-label">Total Volume</span>
                        </div>
                        <div class="mini-stat">
                            <span class="mini-stat-value">{{ formatCurrency(submissionMetrics.ytdCost) }}</span>
                            <span class="mini-stat-label">Total Cost</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Adjustments (12 Months)</h3>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="mini-stat">
                            <span class="mini-stat-value text-amber-600">{{ submissionMetrics.adjustmentPercentage
                                }}%</span>
                            <span class="mini-stat-label">Adjustment Rate</span>
                        </div>
                        <div class="mini-stat">
                            <span class="mini-stat-value">{{ formatNumber(getTotalAdjustments()) }}</span>
                            <span class="mini-stat-label">Total Adjustments</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Submissions vs Expected (Monthly)</h3>
                    </div>
                    <div class="h-[280px]">
                        <p-chart type="bar" [data]="submissionsTrendChartData" [options]="submissionsTrendChartOptions"
                            [style]="{'width': '100%', 'height': '100%'}"></p-chart>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Top 5 Adjustment Reasons</h3>
                    </div>
                    <div class="h-[280px]">
                        <p-chart type="bar" [data]="adjustmentReasonsChartData"
                            [options]="adjustmentReasonsChartOptions"
                            [style]="{'width': '100%', 'height': '100%'}"></p-chart>
                    </div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- PAYMENT TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-credit-card mr-2"></i>
                <span>Payment</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="exec-stat-card">
                    <div class="exec-stat-icon emerald">
                        <i class="pi pi-calendar"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatDate(paymentMetrics.lastPaymentDate) }}</span>
                        <span class="exec-stat-label">Last Claims Payment</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon violet">
                        <i class="pi pi-box"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ paymentMetrics.batchesPaid }}</span>
                        <span class="exec-stat-label">Batches Paid (YTD)</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon teal">
                        <i class="pi pi-dollar"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatCurrency(paymentMetrics.amountsPaid) }}</span>
                        <span class="exec-stat-label">Total Paid (YTD)</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon sky">
                        <i class="pi pi-clock"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ paymentMetrics.avgPaymentTimeMonths }}</span>
                        <span class="exec-stat-label">Avg. Payment Time (Months)</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="dashboard-card" [class]="getPerformanceStatusClass()">
                    <div class="card-header">
                        <h3 class="card-title"><i class="pi pi-chart-bar"></i> NHIS Payment Performance</h3>
                        <span class="px-3 py-1 rounded-full text-sm font-medium capitalize"
                            [class]="getPerformanceStatusClass()">
                            {{ paymentMetrics.performanceStatus }}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="gauge-item">
                            <div class="gauge-circle"
                                [class]="paymentMetrics.avgVettingTimeDays <= 10 ? 'good' : 'warning'">
                                <span class="gauge-value">{{ paymentMetrics.avgVettingTimeDays }}</span>
                                <span class="gauge-unit">days</span>
                            </div>
                            <span class="gauge-label">Avg. Vetting Time</span>
                            <span class="gauge-target">Target: ≤10 days</span>
                        </div>
                        <div class="gauge-item">
                            <div class="gauge-circle"
                                [class]="paymentMetrics.avgPaymentTimeDays <= 5 ? 'good' : 'warning'">
                                <span class="gauge-value">{{ paymentMetrics.avgPaymentTimeDays }}</span>
                                <span class="gauge-unit">days</span>
                            </div>
                            <span class="gauge-label">Avg. Payment Time</span>
                            <span class="gauge-target">Target: ≤5 days</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Paid vs Pending Batches (5-Year)</h3>
                    </div>
                    <div class="flex flex-col gap-3">
                        @for (year of paymentMetrics.yearlyBatchData; track year.yearRange) {
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">{{ year.yearRange }}</span>
                                <span class="font-semibold">{{ year.paidPercentage }}% paid</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" [class]="getProgressClass(year.paidPercentage)"
                                    [style.width.%]="year.paidPercentage"></div>
                            </div>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- MEDICINES TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-heart mr-2"></i>
                <span>Medicines</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="facilityTypeOptions" [(ngModel)]="selectedFacilityType"
                            placeholder="Facility Type" [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="exec-stat-card">
                    <div class="exec-stat-icon rose">
                        <i class="pi pi-calendar"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatDate(medicinesMetrics.lastMedicineReviewDate) }}</span>
                        <span class="exec-stat-label">Last Medicine Review</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon violet">
                        <i class="pi pi-list"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ medicinesMetrics.totalMedicinesOnML | number }}</span>
                        <span class="exec-stat-label">Medicines on List</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon amber">
                        <i class="pi pi-exclamation-triangle"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ medicinesMetrics.opdAntibioticRate }}/1000</span>
                        <span class="exec-stat-label">OPD Antibiotic Rate</span>
                        <span class="exec-stat-change neutral">{{ medicinesMetrics.ipdAntibioticRate }}/1000 IPD</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Top 10 Medicines by Frequency</h3>
                    </div>
                    <div class="overflow-x-auto max-h-[300px]">
                        <table class="exec-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Medicine</th>
                                    <th>Frequency</th>
                                    <th>Class</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (med of medicinesMetrics.top10MedicinesByFreq; track med.rank) {
                                <tr>
                                    <td class="font-medium">{{ med.rank }}</td>
                                    <td>{{ med.name }}</td>
                                    <td class="font-semibold">{{ med.frequency | number }}</td>
                                    <td><span class="exec-tag">{{ med.therapeuticClass }}</span></td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Top 10 Medicines by Cost</h3>
                    </div>
                    <div class="overflow-x-auto max-h-[300px]">
                        <table class="exec-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Medicine</th>
                                    <th>Cost</th>
                                    <th>Class</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (med of medicinesMetrics.top10MedicinesByCost; track med.rank) {
                                <tr>
                                    <td class="font-medium">{{ med.rank }}</td>
                                    <td>{{ med.name }}</td>
                                    <td class="font-semibold">{{ formatCurrency(med.cost) }}</td>
                                    <td><span class="exec-tag">{{ med.therapeuticClass }}</span></td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="dashboard-card h-[550px]">
                <div class="card-header">
                    <h3 class="card-title"><i class="pi pi-chart-line text-amber-500 mr-2"></i>Antibiotic Prescription
                        Trend (Monthly)</h3>
                    <div class="flex items-center gap-4 text-xs">
                        <span class="flex items-center gap-1">
                            <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                            Rate per 1000 encounters
                        </span>
                        <span class="text-slate-400">|</span>
                        <span class="text-slate-500">Target: ≤4 OPD / ≤5 IPD</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                    <div class="lg:col-span-3 h-[550px] overflow-hidden relative">
                        <p-chart type="line" [data]="antibioticTrendChartData" [options]="antibioticTrendChartOptions"
                            [style]="{'width': '100%', 'max-height': '160px'}"></p-chart>
                    </div>
                    <div class="flex flex-col justify-center gap-3">
                        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 text-center">
                            <span class="block text-2xl font-bold text-amber-700">{{ medicinesMetrics.opdAntibioticRate
                                }}</span>
                            <span class="text-xs text-amber-600">OPD per 1000</span>
                        </div>
                        <div class="bg-rose-50 border border-rose-200 rounded-lg p-3 text-center">
                            <span class="block text-2xl font-bold text-rose-700">{{ medicinesMetrics.ipdAntibioticRate
                                }}</span>
                            <span class="text-xs text-rose-600">IPD per 1000</span>
                        </div>
                    </div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- MEMBERSHIP TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-users mr-2"></i>
                <span>Membership</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="exec-stat-card">
                    <div class="exec-stat-icon violet">
                        <i class="pi pi-users"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatNumber(membershipMetrics.activeMembershipToday) }}</span>
                        <span class="exec-stat-label">Active Members Today</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon slate">
                        <i class="pi pi-id-card"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ formatNumber(membershipMetrics.totalMembership) }}</span>
                        <span class="exec-stat-label">Total Membership</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon emerald">
                        <i class="pi pi-percentage"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ membershipMetrics.annualActivePercentage }}%</span>
                        <span class="exec-stat-label">Annual Active Rate</span>
                    </div>
                </div>

                <div class="exec-stat-card border-red-200 bg-red-50">
                    <div class="exec-stat-icon red">
                        <i class="pi pi-exclamation-circle"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value text-red-700">{{ membershipMetrics.lowestRiskProtectionRegion
                            }}</span>
                        <span class="exec-stat-label">Lowest Financial Protection</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">Renewal Rate by Region</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                    @for (region of membershipMetrics.regionalRenewals; track region.region) {
                    <div class="regional-stat-card">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-semibold text-slate-900">{{ region.region }}</span>
                            <span class="text-lg font-bold"
                                [class]="region.renewalRate >= 75 ? 'text-emerald-600' : 'text-amber-600'">
                                {{ region.renewalRate }}%
                            </span>
                        </div>
                        <div class="progress-bar mb-2">
                            <div class="progress-fill" [class]="region.renewalRate >= 75 ? 'emerald' : 'amber'"
                                [style.width.%]="region.renewalRate"></div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500">
                            <span>{{ region.renewedMembers | number }} renewed</span>
                            <span>FRP: {{ region.financialRiskProtection }}%</span>
                        </div>
                    </div>
                    }
                </div>
                <div class="flex items-center gap-4 mt-4 pt-4 border-t border-slate-100">
                    <span class="text-xs text-slate-500">Legend:</span>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-emerald-500"></span><span
                            class="text-xs">≥75% (Good)</span></div>
                    <div class="flex items-center gap-2"><span class="w-3 h-3 rounded bg-amber-500"></span><span
                            class="text-xs">&lt;75% (Needs Attention)</span></div>
                    <span class="text-slate-300">|</span>
                    <span class="text-xs text-slate-500">FRP = Financial Risk Protection</span>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- SERVICES TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-th-large mr-2"></i>
                <span>Services</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="facilityTypeOptions" [(ngModel)]="selectedFacilityType"
                            placeholder="Facility Type" [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Top 10 OPD GDRGs</h3>
                        <span class="text-sm text-slate-500">Total: {{
                            formatCurrency(servicesMetrics.totalOPDServiceCost) }}</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="exec-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Description</th>
                                    <th>Frequency</th>
                                    <th>% Contribution</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (gdrg of servicesMetrics.top10OPDGDRGs; track gdrg.code) {
                                <tr>
                                    <td class="font-medium text-sky-600">{{ gdrg.code }}</td>
                                    <td>{{ gdrg.description }}</td>
                                    <td>{{ gdrg.frequency | number }}</td>
                                    <td>
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                                                <div class="h-full bg-sky-500 rounded-full"
                                                    [style.width.%]="gdrg.costContribution * 5"></div>
                                            </div>
                                            <span class="text-sm font-medium">{{ gdrg.costContribution }}%</span>
                                        </div>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Top 10 IPD GDRGs</h3>
                        <span class="text-sm text-slate-500">Total: {{
                            formatCurrency(servicesMetrics.totalIPDServiceCost) }}</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="exec-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Description</th>
                                    <th>Frequency</th>
                                    <th>% Contribution</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (gdrg of servicesMetrics.top10IPDGDRGs; track gdrg.code) {
                                <tr>
                                    <td class="font-medium text-pink-600">{{ gdrg.code }}</td>
                                    <td>{{ gdrg.description }}</td>
                                    <td>{{ gdrg.frequency | number }}</td>
                                    <td>
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 h-2 bg-slate-100 rounded-full overflow-hidden">
                                                <div class="h-full bg-pink-500 rounded-full"
                                                    [style.width.%]="gdrg.costContribution * 4"></div>
                                            </div>
                                            <span class="text-sm font-medium">{{ gdrg.costContribution }}%</span>
                                        </div>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </p-tabPanel>

        <!-- ============================================ -->
        <!-- CLAIMS TAB -->
        <!-- ============================================ -->
        <p-tabPanel>
            <ng-template pTemplate="header">
                <i class="pi pi-file mr-2"></i>
                <span>Claims</span>
            </ng-template>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="pi pi-filter text-slate-400"></i>
                        <span class="text-sm font-medium text-slate-600">Filters:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3">
                        <p-dropdown [options]="timePeriodOptions" [(ngModel)]="selectedTimePeriod"
                            placeholder="Time Period" [style]="{'min-width': '150px'}"></p-dropdown>
                        <p-dropdown [options]="regionOptions" [(ngModel)]="selectedRegion" placeholder="Region"
                            [style]="{'min-width': '150px'}"></p-dropdown>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button pButton type="button" label="Reset" icon="pi pi-refresh"
                            class="p-button-outlined p-button-secondary p-button-sm"></button>
                        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm"></button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="exec-stat-card flex-col items-center">
                    <span class="text-sm font-medium text-slate-600 mb-2">OPD vs IPD Claims</span>
                    <div class="w-[100px] h-[100px]">
                        <p-chart type="doughnut" [data]="opdIpdChartData" [options]="opdIpdChartOptions"></p-chart>
                    </div>
                    <div class="flex gap-4 mt-2 text-xs">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded bg-cyan-500"></span>OPD {{
                            claimsMetrics.opdClaimsPercentage }}%</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded bg-pink-500"></span>IPD {{
                            claimsMetrics.ipdClaimsPercentage }}%</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon pink">
                        <i class="pi pi-percentage"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ claimsMetrics.utilizationByTotalMembership }}%</span>
                        <span class="exec-stat-label">Utilization (Total)</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon indigo">
                        <i class="pi pi-chart-line"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{ claimsMetrics.utilizationByActivePercentage }}%</span>
                        <span class="exec-stat-label">Utilization (Active)</span>
                    </div>
                </div>

                <div class="exec-stat-card">
                    <div class="exec-stat-icon violet">
                        <i class="pi pi-heart"></i>
                    </div>
                    <div class="exec-stat-content">
                        <span class="exec-stat-value">{{
                            formatNumber(claimsMetrics.deliveries[claimsMetrics.deliveries.length - 1].count) }}</span>
                        <span class="exec-stat-label">Deliveries ({{
                            claimsMetrics.deliveries[claimsMetrics.deliveries.length - 1].year }})</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Claims by Membership Category</h3>
                    </div>
                    <div class="flex flex-col gap-3">
                        @for (cat of claimsMetrics.claimsByCategory; track cat.category) {
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">{{ cat.category }}</span>
                                <span class="font-semibold">{{ cat.claims | number }} ({{ cat.percentage }}%)</span>
                            </div>
                            <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full rounded-full" [style.width.%]="cat.percentage * 2.5"
                                    [style.background]="cat.color"></div>
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Utilization Trend (Monthly)</h3>
                    </div>
                    <div class="h-[220px]">
                        <p-chart type="line" [data]="utilizationTrendChartData" [options]="utilizationTrendChartOptions"
                            [style]="{'width': '100%', 'height': '100%'}"></p-chart>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Claims Variation (MoM vs Previous Year)</h3>
                    </div>
                    <div class="overflow-x-auto max-h-[250px]">
                        <table class="exec-table">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Current Year</th>
                                    <th>Previous Year</th>
                                    <th>Variation</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (v of claimsMetrics.claimsVariations.slice(0, 6); track v.month) {
                                <tr>
                                    <td class="font-medium">{{ v.month }}</td>
                                    <td>{{ v.currentYear | number }}</td>
                                    <td>{{ v.previousYear | number }}</td>
                                    <td>
                                        <span
                                            class="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium"
                                            [class]="v.direction === 'increase' ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'">
                                            <i class="pi"
                                                [class]="v.direction === 'increase' ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
                                            {{ v.variation > 0 ? '+' : '' }}{{ v.variation }}%
                                        </span>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Deliveries (Year on Year)</h3>
                    </div>
                    <div class="h-[220px]">
                        <p-chart type="bar" [data]="deliveriesChartData" [options]="deliveriesChartOptions"
                            [style]="{'width': '100%', 'height': '100%'}"></p-chart>
                    </div>
                </div>
            </div>
        </p-tabPanel>
    </p-tabView>
</main>